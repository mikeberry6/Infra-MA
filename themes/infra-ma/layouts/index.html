{{ define "main" }}
{{ $deals := where .Site.RegularPages "Section" "deals" }}
{{ $totalDeals := len $deals }}
{{ $totalValue := 0.0 }}
{{ $closedCount := 0 }}
{{ $announcedCount := 0 }}
{{ $terminatedCount := 0 }}
{{ range $deals }}
  {{ with .Params.value_usd_billions }}{{ $totalValue = add $totalValue . }}{{ end }}
  {{ if eq .Params.status "closed" }}{{ $closedCount = add $closedCount 1 }}{{ end }}
  {{ if eq .Params.status "announced" }}{{ $announcedCount = add $announcedCount 1 }}{{ end }}
  {{ if eq .Params.status "terminated" }}{{ $terminatedCount = add $terminatedCount 1 }}{{ end }}
{{ end }}

{{/* ── Mission Control Hero ── */}}
<section class="hero hero--ops">
  <div class="hero__bg" aria-hidden="true"></div>
  <div class="hero__content container">
    <div class="hero__badge">
      <span class="hero__badge-dot"></span>
      MONITORING {{ $totalDeals }} DEALS
    </div>
    <h1 class="hero__title">{{ .Site.Title }}</h1>
    <p class="hero__tagline">{{ .Site.Params.tagline }}</p>

    {{/* Stats row — clean KPI cards */}}
    <div class="hero__stats">
      <div class="hero__stat">
        <span class="hero__stat-value" id="stat-deals">{{ $totalDeals }}</span>
        <span class="hero__stat-label">Deals Tracked</span>
      </div>
      <div class="hero__stat">
        <span class="hero__stat-value">${{ lang.FormatNumberCustom 0 $totalValue }}B</span>
        <span class="hero__stat-label">Total Value</span>
      </div>
      <div class="hero__stat hero__stat--status">
        <div class="hero__stat-row">
          <span class="hero__stat-status hero__stat-status--closed">{{ $closedCount }}</span>
          <span class="hero__stat-status hero__stat-status--announced">{{ $announcedCount }}</span>
          <span class="hero__stat-status hero__stat-status--terminated">{{ $terminatedCount }}</span>
        </div>
        <span class="hero__stat-label">Closed / Announced / Terminated</span>
      </div>
      <div class="hero__stat">
        {{ $geos := slice }}
        {{ range $deals }}{{ with .Params.geography }}{{ $geos = $geos | append . }}{{ end }}{{ end }}
        <span class="hero__stat-value">{{ len ($geos | uniq) }}</span>
        <span class="hero__stat-label">Geographies</span>
      </div>
    </div>

    {{/* Search */}}
    <div class="hero__search">
      <div id="search" class="search-box"></div>
    </div>

    {{/* Scroll indicator */}}
    <div class="hero__scroll" aria-hidden="true">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>
    </div>
  </div>
</section>

{{/* ── Recent Activity Feed — horizontal rows ── */}}
<section class="section container">
  <div class="section__header">
    <h2 class="section__title">Recent Activity</h2>
    <a href="{{ "deals/" | relURL }}" class="section__link">View All Deals
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
    </a>
  </div>
  {{/* Column headers */}}
  <div class="deal-row deal-row--header" aria-hidden="true">
    <span class="deal-row__status"></span>
    <div class="deal-row__main"><span>Deal</span></div>
    <div class="deal-row__tags"><span>Sector / Region</span></div>
    <div class="deal-row__value"><span>Value</span></div>
    <span class="deal-row__date">Date</span>
  </div>
  <div class="deal-list-feed">
    {{ range first 12 (where .Site.RegularPages "Section" "deals").ByDate.Reverse }}
    {{ partial "deal-row.html" . }}
    {{ end }}
  </div>
</section>

{{/* ── Sector Status Board — clean list ── */}}
<section class="section container">
  <h2 class="section__title">Sector Status Board</h2>
  <div class="sector-list">
    {{ $sectorNames := dict "energy" "Energy" "transport" "Transport" "digital" "Digital" "water" "Water" "social" "Social" }}
    {{ range $key, $name := $sectorNames }}
    {{ $count := 0 }}
    {{ $sectorValue := 0.0 }}
    {{ range (where $.Site.RegularPages "Section" "deals") }}
      {{ if eq .Params.sector $key }}
        {{ $count = add $count 1 }}
        {{ with .Params.value_usd_billions }}{{ $sectorValue = add $sectorValue . }}{{ end }}
      {{ end }}
    {{ end }}
    <a href="{{ "sectors/" | relURL }}{{ $key }}/" class="sector-row sector-row--{{ $key }}">
      <span class="sector-row__indicator"></span>
      <span class="sector-row__name">{{ $name }}</span>
      <span class="sector-row__count">{{ $count }} deals</span>
      <span class="sector-row__spacer"></span>
      <span class="sector-row__value">${{ lang.FormatNumberCustom 1 $sectorValue }}B</span>
    </a>
    {{ end }}
  </div>
</section>
{{ end }}
