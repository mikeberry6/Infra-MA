{{ define "main" }}
{{ $deals := where .Site.RegularPages "Section" "deals" }}
{{ $latestDeals := first 6 ($deals.ByDate.Reverse) }}

{{/* Hero */}}
<section class="hero">
  <div class="hero-glow"></div>
  <div class="container">
    <p class="hero-tagline">Infrastructure M&amp;A Intelligence</p>
    <h1 class="hero-title">Sponsor-Backed<br><span class="hero-title-accent">Deal Tracker</span></h1>
    <p class="hero-subtitle">Monitoring {{ with .Site.Data.funds }}{{ len . }}{{ end }} infrastructure funds across {{ with .Site.Data.sectors }}{{ len . }}{{ end }} sectors for M&amp;A activity, updated weekly.</p>
  </div>
</section>

{{/* Stats */}}
<section class="section">
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-value">{{ len $deals }}</span>
        <span class="stat-label">Deals Tracked</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ with .Site.Data.funds }}{{ len . }}{{ end }}</span>
        <span class="stat-label">Funds Monitored</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ with .Site.Data.sectors }}{{ len . }}{{ end }}</span>
        <span class="stat-label">Sectors Covered</span>
      </div>
    </div>
  </div>
</section>

{{/* Latest Deals */}}
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Latest Deals</h2>
      <a href="{{ "deals/" | relURL }}" class="section-link">View all deals &rarr;</a>
    </div>
    {{ if $latestDeals }}
    <div class="deal-grid">
      {{ range $latestDeals }}
      {{ partial "deal-card.html" . }}
      {{ end }}
    </div>
    {{ else }}
    <div class="empty-state">
      <p>No deals tracked yet. Check back after the next weekly update.</p>
    </div>
    {{ end }}
  </div>
</section>

{{/* Sectors */}}
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Browse by Sector</h2>
      <a href="{{ "sectors/" | relURL }}" class="section-link">All sectors &rarr;</a>
    </div>
    {{ with .Site.Data.sectors }}
    <div class="sector-grid">
      {{ range $name, $sector := . }}
      {{ $sectorDeals := where ($.Site.RegularPages) "Params.sector" $name }}
      <a href="{{ "sectors/" | relURL }}{{ $name | urlize }}/" class="sector-card" style="border-left-color: {{ $sector.color }}">
        <div>
          <h3 class="sector-card-name">{{ $name }}</h3>
          <span class="sector-card-count">{{ len $sectorDeals }} {{ if eq (len $sectorDeals) 1 }}deal{{ else }}deals{{ end }} Â· {{ len $sector.subsectors }} subsectors</span>
        </div>
      </a>
      {{ end }}
    </div>
    {{ end }}
  </div>
</section>

{{/* Funds CTA */}}
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Fund Coverage</h2>
      <a href="{{ "funds/" | relURL }}" class="section-link">View all funds &rarr;</a>
    </div>
    <p class="text-secondary">Tracking M&amp;A activity across <strong>{{ with .Site.Data.funds }}{{ len . }}{{ end }} infrastructure funds</strong> including global infrastructure managers, pension funds, sovereign wealth funds, and private equity firms.</p>
  </div>
</section>
{{ end }}
