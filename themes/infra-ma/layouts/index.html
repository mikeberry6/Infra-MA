{{ define "main" }}
{{ $deals := where .Site.RegularPages "Section" "deals" }}
{{ $latestDeals := first 4 ($deals.ByDate.Reverse) }}
{{ $fundCount := 0 }}{{ with .Site.Data.funds }}{{ $fundCount = len . }}{{ end }}
{{ $sectorCount := 0 }}{{ with .Site.Data.sectors }}{{ $sectorCount = len . }}{{ end }}

{{/* Cinematic Hero */}}
<section class="page-hero">
  <div class="hero-cursor-glow"></div>
  <div class="container">
    <p class="page-hero-eyebrow">Infrastructure M&amp;A Intelligence</p>
    <h1 class="page-hero-title">Sponsor-Backed<br><span class="page-hero-title-accent">Deal Tracker</span></h1>
    <p class="page-hero-subtitle">Tracking {{ $fundCount }} infrastructure funds across {{ $sectorCount }} sectors. Updated weekly.</p>
    <div class="page-hero-divider"></div>
  </div>
</section>

{{/* Bento Grid Dashboard */}}
<section class="section">
  <div class="container">
    <div class="bento">

      {{/* Stat tiles */}}
      <div class="bento-tile bento-tile-stat">
        <span class="stat-value" data-count="{{ len $deals }}">{{ len $deals }}</span>
        <span class="stat-label">Deals Tracked</span>
      </div>
      <div class="bento-tile bento-tile-stat">
        <span class="stat-value" data-count="{{ $fundCount }}">{{ $fundCount }}</span>
        <span class="stat-label">Funds Monitored</span>
      </div>
      <div class="bento-tile bento-tile-stat">
        <span class="stat-value" data-count="{{ $sectorCount }}">{{ $sectorCount }}</span>
        <span class="stat-label">Sectors Covered</span>
      </div>

      {{/* Latest Deals â€” featured tile spanning 2 cols */}}
      <div class="bento-tile bento-tile-deals bento-tile-featured">
        <div class="bento-tile-header">
          <h2 class="bento-tile-title">Latest Deals</h2>
          <a href="{{ "deals/" | relURL }}" class="bento-tile-link">View all &rarr;</a>
        </div>
        {{ if $latestDeals }}
        <div class="deal-grid deal-grid-compact">
          {{ range $latestDeals }}
          {{ partial "deal-card.html" . }}
          {{ end }}
        </div>
        {{ else }}
        <div class="empty-state">
          <h3 class="empty-state-title">No deals tracked yet</h3>
          <p>Check back after the next weekly update.</p>
        </div>
        {{ end }}
      </div>

      {{/* Sectors tile */}}
      <div class="bento-tile bento-tile-sectors">
        <div class="bento-tile-header">
          <h2 class="bento-tile-title">Sectors</h2>
          <a href="{{ "sectors/" | relURL }}" class="bento-tile-link">All sectors &rarr;</a>
        </div>
        {{ with .Site.Data.sectors }}
        <div class="bento-sectors">
          {{ range $name, $sector := . }}
          {{ $sectorDeals := where ($.Site.RegularPages) "Params.sector" $name }}
          <a href="{{ "sectors/" | relURL }}{{ $name | urlize }}/" class="bento-sector-item">
            <span class="bento-sector-dot" style="background: {{ $sector.color }}"></span>
            <span class="bento-sector-name">{{ $name }}</span>
            <span class="bento-sector-count">{{ len $sectorDeals }}</span>
          </a>
          {{ end }}
        </div>
        {{ end }}
      </div>

      {{/* Funds tile */}}
      <div class="bento-tile bento-tile-funds">
        <div class="bento-tile-header">
          <h2 class="bento-tile-title">Fund Coverage</h2>
          <a href="{{ "funds/" | relURL }}" class="bento-tile-link">All funds &rarr;</a>
        </div>
        {{ $allFunds := .Site.Data.funds }}
        {{ with $allFunds }}
        {{ $topFunds := first 8 . }}
        {{ range $topFunds }}
        {{ $fundDeals := where ($.Site.RegularPages) "Params.buyer" . }}
        <a href="{{ "funds/" | relURL }}{{ . | urlize }}/" class="bento-fund-row">
          <strong>{{ . }}</strong>
          <span>{{ len $fundDeals }} deals</span>
        </a>
        {{ end }}
        <a href="{{ "funds/" | relURL }}" class="bento-tile-link" style="margin-top: var(--space-2); display: block">+ {{ sub (len $allFunds) 8 }} more</a>
        {{ end }}
      </div>

    </div>
  </div>
</section>
{{ end }}
